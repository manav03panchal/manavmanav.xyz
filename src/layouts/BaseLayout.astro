---
import BaseHead from "../components/BaseHead.astro";
---

<html lang="en" class="selection:bg-secondary selection:text-secondary">
  <head>
    <BaseHead />
    <script is:inline>
      // Prevent flash of wrong theme
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="bg-primary transition-colors duration-300">
    <slot />
    <script type="text/javascript" src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script type="text/javascript">
      AOS.init({
        once: true,
      });
    </script>
    <script>
      function updateToggleButton() {
        const isDark = document.documentElement.classList.contains('dark');
        const darkIcon = document.querySelector('.dark-icon');
        const lightIcon = document.querySelector('.light-icon');
        if (darkIcon && lightIcon) {
          darkIcon.classList.toggle('hidden', !isDark);
          lightIcon.classList.toggle('hidden', isDark);
        }
      }

      function toggleTheme() {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateToggleButton();
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', () => {
        updateToggleButton();
        const toggleBtn = document.getElementById('theme-toggle');
        if (toggleBtn) {
          toggleBtn.addEventListener('click', toggleTheme);
        }
      });

      // Handle Astro page transitions
      document.addEventListener('astro:page-load', () => {
        updateToggleButton();
        const toggleBtn = document.getElementById('theme-toggle');
        if (toggleBtn) {
          toggleBtn.addEventListener('click', toggleTheme);
        }
      });
    </script>
  </body>
</html>
